{% doc %}
  @prompt
    a section to display the 3d box which can be rotated having orbit control feature, a real 3d box, nox 3d box is showing, now make it a 2:3 in ratio, make it a poster 1 mm poster of 2:3 in ratio, why there is a split in the poster seems like poster is made from four poster remove the extra lines and split from the scene just a 1mm metal poster
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-3d-poster-container-{{ ai_gen_id }} {
    width: 100%;
    height: {{ block.settings.container_height }}px;
    display: flex;
    justify-content: center;
    align-items: center;
    background: {{ block.settings.background_color }};
    border-radius: {{ block.settings.border_radius }}px;
    overflow: hidden;
    position: relative;
  }

  .ai-3d-poster-scene-{{ ai_gen_id }} {
    width: {{ block.settings.poster_width }}px;
    height: {{ block.settings.poster_height }}px;
    perspective: 1000px;
    position: relative;
  }

  .ai-3d-poster-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.1s ease-out;
    cursor: grab;
  }

  .ai-3d-poster-{{ ai_gen_id }}:active {
    cursor: grabbing;
  }

  .ai-3d-poster-face-{{ ai_gen_id }} {
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: {{ block.settings.text_size }}px;
    font-weight: bold;
    color: {{ block.settings.text_color }};
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }

  .ai-3d-poster-front-{{ ai_gen_id }} {
    width: {{ block.settings.poster_width }}px;
    height: {{ block.settings.poster_height }}px;
    background: {{ block.settings.front_color }};
    transform: translateZ(0.5px);
  }

  .ai-3d-poster-back-{{ ai_gen_id }} {
    width: {{ block.settings.poster_width }}px;
    height: {{ block.settings.poster_height }}px;
    background: {{ block.settings.back_color }};
    transform: translateZ(-0.5px) rotateY(180deg);
  }

  .ai-3d-poster-right-{{ ai_gen_id }} {
    width: 1px;
    height: {{ block.settings.poster_height }}px;
    background: {{ block.settings.edge_color }};
    transform: rotateY(90deg) translateZ({{ block.settings.poster_width | divided_by: 2 }}px);
  }

  .ai-3d-poster-left-{{ ai_gen_id }} {
    width: 1px;
    height: {{ block.settings.poster_height }}px;
    background: {{ block.settings.edge_color }};
    transform: rotateY(-90deg) translateZ({{ block.settings.poster_width | divided_by: 2 }}px);
  }

  .ai-3d-poster-top-{{ ai_gen_id }} {
    width: {{ block.settings.poster_width }}px;
    height: 1px;
    background: {{ block.settings.edge_color }};
    transform: rotateX(90deg) translateZ({{ block.settings.poster_height | divided_by: 2 }}px);
  }

  .ai-3d-poster-bottom-{{ ai_gen_id }} {
    width: {{ block.settings.poster_width }}px;
    height: 1px;
    background: {{ block.settings.edge_color }};
    transform: rotateX(-90deg) translateZ({{ block.settings.poster_height | divided_by: 2 }}px);
  }

  .ai-3d-poster-controls-{{ ai_gen_id }} {
    position: absolute;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 8px;
    z-index: 10;
  }

  .ai-3d-poster-control-btn-{{ ai_gen_id }} {
    padding: 8px 12px;
    background: {{ block.settings.control_bg_color }};
    color: {{ block.settings.control_text_color }};
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
  }

  .ai-3d-poster-control-btn-{{ ai_gen_id }}:hover {
    opacity: 0.8;
  }

  .ai-3d-poster-info-{{ ai_gen_id }} {
    position: absolute;
    bottom: 10px;
    left: 10px;
    color: {{ block.settings.text_color }};
    font-size: 12px;
    opacity: 0.7;
  }

  .ai-3d-poster-specs-{{ ai_gen_id }} {
    position: absolute;
    top: 10px;
    left: 10px;
    color: {{ block.settings.text_color }};
    font-size: 11px;
    opacity: 0.6;
    background: rgba(0, 0, 0, 0.1);
    padding: 5px 8px;
    border-radius: 4px;
  }

  @media screen and (max-width: 768px) {
    .ai-3d-poster-scene-{{ ai_gen_id }} {
      width: {{ block.settings.poster_width | times: 0.7 }}px;
      height: {{ block.settings.poster_height | times: 0.7 }}px;
    }

    .ai-3d-poster-front-{{ ai_gen_id }},
    .ai-3d-poster-back-{{ ai_gen_id }} {
      width: {{ block.settings.poster_width | times: 0.7 }}px;
      height: {{ block.settings.poster_height | times: 0.7 }}px;
      font-size: {{ block.settings.text_size | times: 0.8 }}px;
    }

    .ai-3d-poster-right-{{ ai_gen_id }},
    .ai-3d-poster-left-{{ ai_gen_id }} {
      height: {{ block.settings.poster_height | times: 0.7 }}px;
      transform: rotateY(90deg) translateZ({{ block.settings.poster_width | divided_by: 2 | times: 0.7 }}px);
    }

    .ai-3d-poster-left-{{ ai_gen_id }} {
      transform: rotateY(-90deg) translateZ({{ block.settings.poster_width | divided_by: 2 | times: 0.7 }}px);
    }

    .ai-3d-poster-top-{{ ai_gen_id }},
    .ai-3d-poster-bottom-{{ ai_gen_id }} {
      width: {{ block.settings.poster_width | times: 0.7 }}px;
      transform: rotateX(90deg) translateZ({{ block.settings.poster_height | divided_by: 2 | times: 0.7 }}px);
    }

    .ai-3d-poster-bottom-{{ ai_gen_id }} {
      transform: rotateX(-90deg) translateZ({{ block.settings.poster_height | divided_by: 2 | times: 0.7 }}px);
    }
  }
{% endstyle %}

<rotating-3d-poster-{{ ai_gen_id }}
  class="ai-3d-poster-container-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-3d-poster-scene-{{ ai_gen_id }}">
    <div class="ai-3d-poster-{{ ai_gen_id }}" id="ai-3d-poster-{{ ai_gen_id }}">
      <div class="ai-3d-poster-face-{{ ai_gen_id }} ai-3d-poster-front-{{ ai_gen_id }}">
        {% if block.settings.front_image %}
          <img
            src="{{ block.settings.front_image | image_url: width: block.settings.poster_width }}"
            alt="{{ block.settings.front_image.alt | escape }}"
            style="width: 100%; height: 100%; object-fit: cover;"
            loading="lazy"
          >
        {% else %}
          {{ block.settings.front_text }}
        {% endif %}
      </div>
      <div class="ai-3d-poster-face-{{ ai_gen_id }} ai-3d-poster-back-{{ ai_gen_id }}">
        {% if block.settings.back_image %}
          <img
            src="{{ block.settings.back_image | image_url: width: block.settings.poster_width }}"
            alt="{{ block.settings.back_image.alt | escape }}"
            style="width: 100%; height: 100%; object-fit: cover;"
            loading="lazy"
          >
        {% else %}
          {{ block.settings.back_text }}
        {% endif %}
      </div>
      <div class="ai-3d-poster-face-{{ ai_gen_id }} ai-3d-poster-right-{{ ai_gen_id }}"></div>
      <div class="ai-3d-poster-face-{{ ai_gen_id }} ai-3d-poster-left-{{ ai_gen_id }}"></div>
      <div class="ai-3d-poster-face-{{ ai_gen_id }} ai-3d-poster-top-{{ ai_gen_id }}"></div>
      <div class="ai-3d-poster-face-{{ ai_gen_id }} ai-3d-poster-bottom-{{ ai_gen_id }}"></div>
    </div>
  </div>

  <div class="ai-3d-poster-specs-{{ ai_gen_id }}">
    {{ block.settings.poster_width | divided_by: 10 }}cm × {{ block.settings.poster_height | divided_by: 10 }}cm<br>
    1mm thick metal poster
  </div>

  <div class="ai-3d-poster-controls-{{ ai_gen_id }}">
    <button class="ai-3d-poster-control-btn-{{ ai_gen_id }}" id="ai-reset-{{ ai_gen_id }}">Reset</button>
    <button class="ai-3d-poster-control-btn-{{ ai_gen_id }}" id="ai-auto-rotate-{{ ai_gen_id }}">Auto</button>
  </div>

  <div class="ai-3d-poster-info-{{ ai_gen_id }}">
    Drag to rotate • Scroll to zoom
  </div>
</rotating-3d-poster-{{ ai_gen_id }}>

<script>
  (function() {
    class Rotating3DPoster{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.rotationX = -10;
        this.rotationY = 25;
        this.scale = 1;
        this.isDragging = false;
        this.lastMouseX = 0;
        this.lastMouseY = 0;
        this.autoRotate = false;
        this.animationId = null;
      }

      connectedCallback() {
        this.poster = this.querySelector('#ai-3d-poster-{{ ai_gen_id }}');
        this.resetBtn = this.querySelector('#ai-reset-{{ ai_gen_id }}');
        this.autoRotateBtn = this.querySelector('#ai-auto-rotate-{{ ai_gen_id }}');

        this.setupEventListeners();
        this.updateTransform();
      }

      setupEventListeners() {
        this.addEventListener('mousedown', this.handleMouseDown.bind(this));
        this.addEventListener('mousemove', this.handleMouseMove.bind(this));
        this.addEventListener('mouseup', this.handleMouseUp.bind(this));
        this.addEventListener('mouseleave', this.handleMouseUp.bind(this));
        this.addEventListener('wheel', this.handleWheel.bind(this));

        this.addEventListener('touchstart', this.handleTouchStart.bind(this));
        this.addEventListener('touchmove', this.handleTouchMove.bind(this));
        this.addEventListener('touchend', this.handleTouchEnd.bind(this));

        this.resetBtn.addEventListener('click', this.reset.bind(this));
        this.autoRotateBtn.addEventListener('click', this.toggleAutoRotate.bind(this));
      }

      handleMouseDown(e) {
        if (e.target.closest('.ai-3d-poster-controls-{{ ai_gen_id }}') || 
            e.target.closest('.ai-3d-poster-specs-{{ ai_gen_id }}')) return;
        this.isDragging = true;
        this.lastMouseX = e.clientX;
        this.lastMouseY = e.clientY;
        e.preventDefault();
      }

      handleMouseMove(e) {
        if (!this.isDragging) return;

        const deltaX = e.clientX - this.lastMouseX;
        const deltaY = e.clientY - this.lastMouseY;

        this.rotationY += deltaX * 0.5;
        this.rotationX -= deltaY * 0.5;

        this.rotationX = Math.max(-90, Math.min(90, this.rotationX));

        this.lastMouseX = e.clientX;
        this.lastMouseY = e.clientY;

        this.updateTransform();
        e.preventDefault();
      }

      handleMouseUp() {
        this.isDragging = false;
      }

      handleTouchStart(e) {
        if (e.target.closest('.ai-3d-poster-controls-{{ ai_gen_id }}') || 
            e.target.closest('.ai-3d-poster-specs-{{ ai_gen_id }}')) return;
        if (e.touches.length === 1) {
          this.isDragging = true;
          this.lastMouseX = e.touches[0].clientX;
          this.lastMouseY = e.touches[0].clientY;
          e.preventDefault();
        }
      }

      handleTouchMove(e) {
        if (!this.isDragging || e.touches.length !== 1) return;

        const deltaX = e.touches[0].clientX - this.lastMouseX;
        const deltaY = e.touches[0].clientY - this.lastMouseY;

        this.rotationY += deltaX * 0.5;
        this.rotationX -= deltaY * 0.5;

        this.rotationX = Math.max(-90, Math.min(90, this.rotationX));

        this.lastMouseX = e.touches[0].clientX;
        this.lastMouseY = e.touches[0].clientY;

        this.updateTransform();
        e.preventDefault();
      }

      handleTouchEnd() {
        this.isDragging = false;
      }

      handleWheel(e) {
        e.preventDefault();
        const delta = e.deltaY > 0 ? 0.9 : 1.1;
        this.scale = Math.max(0.3, Math.min(3, this.scale * delta));
        this.updateTransform();
      }

      updateTransform() {
        if (this.poster) {
          this.poster.style.transform = `
            rotateX(${this.rotationX}deg) 
            rotateY(${this.rotationY}deg) 
            scale(${this.scale})
          `;
        }
      }

      reset() {
        this.rotationX = -10;
        this.rotationY = 25;
        this.scale = 1;
        this.updateTransform();
      }

      toggleAutoRotate() {
        this.autoRotate = !this.autoRotate;
        this.autoRotateBtn.textContent = this.autoRotate ? 'Stop' : 'Auto';
        
        if (this.autoRotate) {
          this.startAutoRotation();
        } else {
          this.stopAutoRotation();
        }
      }

      startAutoRotation() {
        const animate = () => {
          if (this.autoRotate && !this.isDragging) {
            this.rotationY += 0.3;
            this.updateTransform();
          }
          if (this.autoRotate) {
            this.animationId = requestAnimationFrame(animate);
          }
        };
        animate();
      }

      stopAutoRotation() {
        if (this.animationId) {
          cancelAnimationFrame(this.animationId);
          this.animationId = null;
        }
      }

      disconnectedCallback() {
        this.stopAutoRotation();
      }
    }

    customElements.define('rotating-3d-poster-{{ ai_gen_id }}', Rotating3DPoster{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "3D metal poster",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Poster dimensions"
    },
    {
      "type": "range",
      "id": "poster_width",
      "min": 120,
      "max": 400,
      "step": 10,
      "unit": "px",
      "label": "Poster width",
      "default": 200
    },
    {
      "type": "range",
      "id": "poster_height",
      "min": 180,
      "max": 600,
      "step": 10,
      "unit": "px",
      "label": "Poster height",
      "default": 300
    },
    {
      "type": "range",
      "id": "container_height",
      "min": 300,
      "max": 800,
      "step": 20,
      "unit": "px",
      "label": "Container height",
      "default": 500
    },
    {
      "type": "header",
      "content": "Front side"
    },
    {
      "type": "image_picker",
      "id": "front_image",
      "label": "Front image"
    },
    {
      "type": "text",
      "id": "front_text",
      "label": "Front text",
      "default": "METAL POSTER"
    },
    {
      "type": "color",
      "id": "front_color",
      "label": "Front background",
      "default": "#e8e8e8"
    },
    {
      "type": "header",
      "content": "Back side"
    },
    {
      "type": "image_picker",
      "id": "back_image",
      "label": "Back image"
    },
    {
      "type": "text",
      "id": "back_text",
      "label": "Back text",
      "default": "PREMIUM QUALITY"
    },
    {
      "type": "color",
      "id": "back_color",
      "label": "Back background",
      "default": "#d4d4d4"
    },
    {
      "type": "header",
      "content": "Styling"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Container background",
      "default": "#f0f0f0"
    },
    {
      "type": "color",
      "id": "edge_color",
      "label": "Metal edge color",
      "default": "#b8b8b8"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#333333"
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Text size",
      "default": 16
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Container border radius",
      "default": 8
    },
    {
      "type": "header",
      "content": "Controls"
    },
    {
      "type": "color",
      "id": "control_bg_color",
      "label": "Control background",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "control_text_color",
      "label": "Control text",
      "default": "#ffffff"
    }
  ],
  "presets": [
    {
      "name": "3D metal poster"
    }
  ]
}
{% endschema %}