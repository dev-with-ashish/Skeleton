{% doc %}
  @prompt
    a block to show featured product with product thumbnails on left with a 3d view button in the thumbnail row main image in the middle and product info like size material title samll description and cutomize now button when 3d view button clicked instead of showing image in the main image are the main image area should have a canvas showing a 1mm metal poster having metalic feature and rotatble and tiltable with drag or touch (for a selected product)

{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-featured-product-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: 120px 1fr 300px;
    gap: 20px;
    max-width: 100%;
    background-color: {{ block.settings.background_color }};
    padding: 20px;
    border-radius: {{ block.settings.border_radius }}px;
  }

  .ai-thumbnails-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .ai-thumbnail-{{ ai_gen_id }} {
    width: 100px;
    height: 100px;
    border: 2px solid transparent;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    transition: border-color 0.3s ease;
    position: relative;
  }

  .ai-thumbnail-{{ ai_gen_id }}.active {
    border-color: {{ block.settings.accent_color }};
  }

  .ai-thumbnail-{{ ai_gen_id }} img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-3d-button-{{ ai_gen_id }} {
    position: absolute;
    top: 5px;
    right: 5px;
    background: {{ block.settings.accent_color }};
    color: white;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 10px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .ai-3d-button-{{ ai_gen_id }}:hover {
    background: {{ block.settings.accent_hover_color }};
  }

  .ai-main-image-{{ ai_gen_id }} {
    position: relative;
    aspect-ratio: 1;
    border-radius: 12px;
    overflow: hidden;background: #f5f5f5;
  }

  .ai-main-image-{{ ai_gen_id }} img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-canvas-container-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #2c3e50, #34495e);
    display: none;
    position: relative;cursor: grab;
  }

  .ai-canvas-container-{{ ai_gen_id }}.active {
    display: block;
  }

  .ai-canvas-container-{{ ai_gen_id }}:active {
    cursor: grabbing;
  }

  .ai-metal-poster-{{ ai_gen_id }} {
    width: 80%;
    height: 80%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotateX(0deg) rotateY(0deg);
    background: linear-gradient(45deg, #c0c0c0, #e8e8e8, #c0c0c0);
    border-radius: 4px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    transition: transform 0.1s ease;
    transform-style: preserve-3d;
  }

  .ai-metal-surface-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23e8e8e8"/><circle cx="20" cy="20" r="1" fill="%23f5f5f5"/><circle cx="80" cy="80" r="1" fill="%23d0d0d0"/></svg>');
    border-radius: 4px;
    position: relative;
    overflow: hidden;
  }

  .ai-metal-surface-{{ ai_gen_id }}::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    animation: ai-shine-{{ ai_gen_id }} 3s infinite;
  }

  @keyframes ai-shine-{{ ai_gen_id }} {
    0% { left: -100%; }
    100% { left: 100%; }
  }

  .ai-product-info-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .ai-product-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.title_size }}px;
    font-weight: 600;
    color: {{ block.settings.text_color }};
    margin: 0;
  }

  .ai-product-description-{{ ai_gen_id }} {
    font-size: {{ block.settings.text_size }}px;
    color: {{ block.settings.text_color }};
    line-height: 1.5;
  }

  .ai-product-details-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .ai-detail-item-{{ ai_gen_id }} {
    display: flex;
    justify-content: space-between;
    font-size: {{ block.settings.text_size }}px;
    color: {{ block.settings.text_color }};
  }

  .ai-detail-label-{{ ai_gen_id }} {
    font-weight: 600;
  }

  .ai-customize-button-{{ ai_gen_id }} {
    background-color: {{ block.settings.button_color }};
    color: {{ block.settings.button_text_color }};
    border: none;
    padding: 15px 25px;
    border-radius: {{ block.settings.button_radius }}px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .ai-customize-button-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_color }};
  }

  .ai-back-button-{{ ai_gen_id }} {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    border: none;
    border-radius: 20px;
    padding: 8px 12px;
    font-size: 12px;
    cursor: pointer;
    display: none;
  }

  .ai-canvas-container-{{ ai_gen_id }}.active .ai-back-button-{{ ai_gen_id }} {
    display: block;
  }

  @media screen and (max-width: 768px) {
    .ai-featured-product-{{ ai_gen_id }} {
      grid-template-columns: 1fr;gap: 15px;
    }

    .ai-thumbnails-{{ ai_gen_id }} {
      flex-direction: row;
      overflow-x: auto;
      padding-bottom: 5px;
    }

    .ai-thumbnail-{{ ai_gen_id }} {
      flex-shrink: 0;
    }
  }
{% endstyle %}<featured-product-3d-{{ ai_gen_id }}
  class="ai-featured-product-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-thumbnails-{{ ai_gen_id }}">
    {% if block.settings.product %}
      {% for image in block.settings.product.images limit: 4 %}
        <div class="ai-thumbnail-{{ ai_gen_id }} {% if forloop.first %}active{% endif %}" data-image-index="{{ forloop.index0 }}">
          <img src="{{ image | image_url: width: 200 }}" alt="{{ image.alt | escape }}" loading="lazy">
          {% if forloop.first %}
            <button class="ai-3d-button-{{ ai_gen_id }}" data-3d-toggle>3D</button>
          {% endif %}
        </div>
      {% endfor %}
    {% else %}
      <div class="ai-thumbnail-{{ ai_gen_id }} active">
        {{ 'product-1' | placeholder_svg_tag }}
      </div>
    {% endif %}
  </div>

  <div class="ai-main-image-{{ ai_gen_id }}">
    {% if block.settings.product and block.settings.product.featured_image %}
      <img 
        src="{{ block.settings.product.featured_image | image_url: width: 800 }}" 
        alt="{{ block.settings.product.featured_image.alt | escape }}"
        class="ai-main-product-image-{{ ai_gen_id }}"
        loading="lazy"
      >
    {% else %}
      {{ 'product-1' | placeholder_svg_tag }}
    {% endif %}<div class="ai-canvas-container-{{ ai_gen_id }}" data-canvas-container>
      <button class="ai-back-button-{{ ai_gen_id }}" data-back-button>‚Üê Back</button>
      <div class="ai-metal-poster-{{ ai_gen_id }}" data-metal-poster>
        <div class="ai-metal-surface-{{ ai_gen_id }}"></div>
      </div>
    </div>
  </div>

  <div class="ai-product-info-{{ ai_gen_id }}">
    {% if block.settings.product %}
      <h2 class="ai-product-title-{{ ai_gen_id }}">{{ block.settings.product.title }}</h2>
      
      {% if block.settings.product.description != blank %}
        <div class="ai-product-description-{{ ai_gen_id }}">
          {{ block.settings.product.description | truncate: 150 }}
        </div>
      {% endif %}

      <div class="ai-product-details-{{ ai_gen_id }}">
        {% if block.settings.size_info != blank %}
          <div class="ai-detail-item-{{ ai_gen_id }}">
            <span class="ai-detail-label-{{ ai_gen_id }}">Size:</span>
            <span>{{ block.settings.size_info }}</span>
          </div>
        {% endif %}
        
        {% if block.settings.material_info != blank %}
          <div class="ai-detail-item-{{ ai_gen_id }}">
            <span class="ai-detail-label-{{ ai_gen_id }}">Material:</span>
            <span>{{ block.settings.material_info }}</span>
          </div>
        {% endif %}

        {% if block.settings.thickness_info != blank %}
          <div class="ai-detail-item-{{ ai_gen_id }}">
            <span class="ai-detail-label-{{ ai_gen_id }}">Thickness:</span>
            <span>{{ block.settings.thickness_info }}</span>
          </div>
        {% endif %}
      </div>

      <a href="{{ block.settings.customize_link | default: block.settings.product.url }}" class="ai-customize-button-{{ ai_gen_id }}">
        {{ block.settings.button_text }}
      </a>
    {% else %}
      <h2 class="ai-product-title-{{ ai_gen_id }}">Select a product</h2>
      <div class="ai-product-description-{{ ai_gen_id }}">Choose a product to display its details and 3D preview.</div>
    {% endif %}
  </div>
</featured-product-3d-{{ ai_gen_id }}>

<script>
(function() {
  class FeaturedProduct3D{{ ai_gen_id }} extends HTMLElement {
    constructor() {
      super();
      this.isDragging = false;
      this.startX = 0;
      this.startY = 0;
      this.rotationX = 0;
      this.rotationY = 0;
    }

    connectedCallback() {
      this.setupEventListeners();
    }

    setupEventListeners() {
      const thumbnails = this.querySelectorAll('.ai-thumbnail-{{ ai_gen_id }}');
      const mainImage = this.querySelector('.ai-main-product-image-{{ ai_gen_id }}');
      const canvasContainer = this.querySelector('[data-canvas-container]');
      const metalPoster = this.querySelector('[data-metal-poster]');
      const backButton = this.querySelector('[data-back-button]');
      const toggle3DButton = this.querySelector('[data-3d-toggle]');

      thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', () => {
          thumbnails.forEach(t => t.classList.remove('active'));
          thumbnail.classList.add('active');
          const imageIndex = thumbnail.dataset.imageIndex;
          const img = thumbnail.querySelector('img');
          if (img && mainImage) {
            mainImage.src = img.src.replace('width=200', 'width=800');
            mainImage.alt = img.alt;
          }
        });
      });

      if (toggle3DButton) {
        toggle3DButton.addEventListener('click', (e) => {
          e.stopPropagation();
          this.show3DView();
        });
      }

      if (backButton) {
        backButton.addEventListener('click', () => {
          this.hide3DView();
        });
      }

      if (metalPoster) {
        this.setup3DInteraction(metalPoster);
      }
    }

    show3DView() {
      const canvasContainer = this.querySelector('[data-canvas-container]');
      const mainImage = this.querySelector('.ai-main-product-image-{{ ai_gen_id }}');
      
      if (canvasContainer) {
        canvasContainer.classList.add('active');
      }
      if (mainImage) {
        mainImage.style.display = 'none';
      }
    }

    hide3DView() {
      const canvasContainer = this.querySelector('[data-canvas-container]');
      const mainImage = this.querySelector('.ai-main-product-image-{{ ai_gen_id }}');
      
      if (canvasContainer) {
        canvasContainer.classList.remove('active');
      }
      if (mainImage) {
        mainImage.style.display = 'block';
      }
    }

    setup3DInteraction(poster) {
      const handleStart = (clientX, clientY) => {
        this.isDragging = true;
        this.startX = clientX;
        this.startY = clientY;
      };

      const handleMove = (clientX, clientY) => {
        if (!this.isDragging) return;

        const deltaX = clientX - this.startX;
        const deltaY = clientY - this.startY;

        this.rotationY += deltaX * 0.5;
        this.rotationX -= deltaY * 0.5;

        this.rotationX = Math.max(-45, Math.min(45, this.rotationX));

        poster.style.transform = `translate(-50%, -50%) rotateX(${this.rotationX}deg) rotateY(${this.rotationY}deg)`;

        this.startX = clientX;
        this.startY = clientY;
      };

      const handleEnd = () => {
        this.isDragging = false;
      };

      poster.addEventListener('mousedown', (e) => {
        e.preventDefault();
        handleStart(e.clientX, e.clientY);
      });

      document.addEventListener('mousemove', (e) => {
        handleMove(e.clientX, e.clientY);
      });

      document.addEventListener('mouseup', handleEnd);

      poster.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        handleStart(touch.clientX, touch.clientY);
      });

      poster.addEventListener('touchmove', (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        handleMove(touch.clientX, touch.clientY);
      });

      poster.addEventListener('touchend', handleEnd);
    }
  }

  customElements.define('featured-product-3d-{{ ai_gen_id }}', FeaturedProduct3D{{ ai_gen_id }});
})();
</script>

{% schema %}
{
  "name": "Featured product3D",
  "settings": [
    {
      "type": "header",
      "content": "Product"
    },
    {
      "type": "product",
      "id": "product",
      "label": "Product"
    },
    {
      "type": "text",
      "id": "size_info",
      "label": "Size information",
      "default": "Custom sizes available"
    },
    {
      "type": "text",
      "id": "material_info",
      "label": "Material information",
      "default": "Premium metal"
    },
    {
      "type": "text",
      "id": "thickness_info",
      "label": "Thickness information",
      "default": "1mm"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Customize now"
    },
    {
      "type": "url",
      "id": "customize_link",
      "label": "Customize link"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent color",
      "default": "#0066cc"
    },
    {
      "type": "color",
      "id": "accent_hover_color",
      "label": "Accent hover color",
      "default": "#004499"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_color",
      "label": "Button hover color",
      "default": "#333333"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 16,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Title size",
      "default": 24
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 14
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "button_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Button radius",
      "default": 6
    }
  ],
  "presets": [
    {
      "name": "Featured product 3D"
    }
  ]
}
{% endschema %}