{% doc %}
  @prompt
    An interactive vertical timeline that highlights as the user scrolls, change date to price range like from this price to this price, title to service title and in the code also add an image for each

{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-timeline-container-{{ ai_gen_id }} {
    max-width: 800px;
    margin: 0 auto;
    padding: {{ block.settings.section_padding }}px 20px;
    background-color: {{ block.settings.background_color }};
  }

  .ai-timeline-{{ ai_gen_id }} {
    position: relative;
    padding-left: 60px;
  }

  .ai-timeline-line-{{ ai_gen_id }} {
    position: absolute;
    left: 20px;
    top: 0;
    bottom: 0;
    width: 4px;
    background-color: {{ block.settings.line_inactive_color }};border-radius: 2px;
  }

  .ai-timeline-progress-{{ ai_gen_id }} {
    position: absolute;
    left: 20px;
    top: 0;
    width: 4px;
    background-color: {{ block.settings.line_active_color }};
    border-radius: 2px;height: 0%;
    transition: height 0.3s ease;
  }

  .ai-timeline-item-{{ ai_gen_id }} {
    position: relative;
    margin-bottom: {{ block.settings.item_spacing }}px;
    opacity: 0.5;
    transition: opacity 0.3s ease;
  }

  .ai-timeline-item-{{ ai_gen_id }}.active {
    opacity: 1;
  }

  .ai-timeline-dot-{{ ai_gen_id }} {
    position: absolute;
    left: -52px;
    top: 8px;
    width: {{ block.settings.dot_size }}px;
    height: {{ block.settings.dot_size }}px;
    background-color: {{ block.settings.dot_inactive_color }};
    border: 3px solid {{ block.settings.background_color }};
    border-radius: 50%;
    transition: all 0.3s ease;
    z-index: 2;
  }

  .ai-timeline-item-{{ ai_gen_id }}.active .ai-timeline-dot-{{ ai_gen_id }} {
    background-color: {{ block.settings.dot_active_color }};
    transform: scale(1.2);
    box-shadow: 0 0 0 4px {{ block.settings.dot_active_color }}33;
  }

  .ai-timeline-content-{{ ai_gen_id }} {
    background-color: {{ block.settings.card_background_color }};
    padding: {{ block.settings.card_padding }}px;
    border-radius: {{ block.settings.card_border_radius }}px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    display: flex;
    gap: 16px;
    align-items: flex-start;
  }

  .ai-timeline-item-{{ ai_gen_id }}.active .ai-timeline-content-{{ ai_gen_id }} {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    transform: translateY(-2px);
  }

  .ai-timeline-image-{{ ai_gen_id }} {
    width: {{ block.settings.image_size }}px;
    height: {{ block.settings.image_size }}px;
    flex-shrink: 0;
    border-radius: {{ block.settings.image_border_radius }}px;
    overflow: hidden;
  }

  .ai-timeline-image-{{ ai_gen_id }} img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-timeline-image-placeholder-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ai-timeline-image-placeholder-{{ ai_gen_id }} svg {
    width: 60%;
    height: 60%;
    opacity: 0.5;
  }

  .ai-timeline-text-content-{{ ai_gen_id }} {
    flex-grow: 1;
  }

  .ai-timeline-price-range-{{ ai_gen_id }} {
    color: {{ block.settings.price_color }};
    font-size: {{ block.settings.price_font_size }}px;
    font-weight: 600;
    margin-bottom: 8px;
  }

  .ai-timeline-service-title-{{ ai_gen_id }} {
    color: {{ block.settings.title_color }};
    font-size: {{ block.settings.title_font_size }}px;
    font-weight: 700;
    margin: 0 0 12px 0;line-height: 1.3;
  }

  .ai-timeline-description-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.text_font_size }}px;
    line-height: 1.5;
    margin: 0;
  }

  @media screen and (max-width: 749px) {
    .ai-timeline-{{ ai_gen_id }} {
      padding-left: 40px;
    }

    .ai-timeline-dot-{{ ai_gen_id }} {
      left: -32px;
      width: {{ block.settings.dot_size | times: 0.8 }}px;
      height: {{ block.settings.dot_size | times: 0.8 }}px;
    }

    .ai-timeline-content-{{ ai_gen_id }} {
      padding: {{ block.settings.card_padding | times: 0.8 }}px;flex-direction: column;gap: 12px;
    }

    .ai-timeline-image-{{ ai_gen_id }} {
      width: 100%;
      height: {{ block.settings.image_size | times: 0.8 }}px;
    }

    .ai-timeline-service-title-{{ ai_gen_id }} {
      font-size: {{ block.settings.title_font_size | times: 0.9 }}px;
    }
  }
{% endstyle %}

<scroll-timeline-{{ ai_gen_id }}
  class="ai-timeline-container-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-timeline-{{ ai_gen_id }}">
    <div class="ai-timeline-line-{{ ai_gen_id }}"></div>
    <div class="ai-timeline-progress-{{ ai_gen_id }}"></div>

    {% for i in (1..6) %}
      {% liquid
        assign price_from_key = 'item_' | append: i | append: '_price_from'
        assign price_to_key = 'item_' | append: i | append: '_price_to'
        assign service_title_key = 'item_' | append: i | append: '_service_title'
        assign description_key = 'item_' | append: i | append: '_description'
        assign image_key = 'item_' | append: i | append: '_image'
        assign price_from = block.settings[price_from_key]
        assign price_to = block.settings[price_to_key]
        assign service_title = block.settings[service_title_key]
        assign description = block.settings[description_key]
        assign image = block.settings[image_key]
      %}

      {% if service_title != blank %}
        <div class="ai-timeline-item-{{ ai_gen_id }}" data-timeline-item="{{ i }}">
          <div class="ai-timeline-dot-{{ ai_gen_id }}"></div>
          <div class="ai-timeline-content-{{ ai_gen_id }}">
            <div class="ai-timeline-image-{{ ai_gen_id }}">
              {% if image %}
                <img
                  src="{{ image | image_url: width: 200}}"
                  alt="{{ image.alt | escape }}"
                  loading="lazy"
                width="200"
                  height="200"
                >
              {% else %}
                <div class="ai-timeline-image-placeholder-{{ ai_gen_id }}">
                  {{ 'image' | placeholder_svg_tag }}
                </div>
              {% endif %}
            </div>
            <div class="ai-timeline-text-content-{{ ai_gen_id }}">
              {% if price_from != blank or price_to != blank %}
                <div class="ai-timeline-price-range-{{ ai_gen_id }}">
                  {% if price_from != blank and price_to != blank %}
                    ${{ price_from }} - ${{ price_to }}
                  {% elsif price_from != blank %}
                    From ${{ price_from }}
                  {% elsif price_to != blank %}
                    Up to ${{ price_to }}
                  {% endif %}
                </div>
              {% endif %}
              <h3 class="ai-timeline-service-title-{{ ai_gen_id }}">{{ service_title }}</h3>
              {% if description != blank %}
                <div class="ai-timeline-description-{{ ai_gen_id }}">{{ description }}</div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</scroll-timeline-{{ ai_gen_id }}>

<script>
  (function() {
    class ScrollTimeline{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.timelineItems = [];
        this.progressBar = null;
        this.isObserving = false;}

      connectedCallback() {
        this.timelineItems = Array.from(this.querySelectorAll('.ai-timeline-item-{{ ai_gen_id }}'));
        this.progressBar = this.querySelector('.ai-timeline-progress-{{ ai_gen_id }}');
        
        if (this.timelineItems.length > 0) {
          this.setupIntersectionObserver();this.setupScrollListener();
        }
      }

      disconnectedCallback() {
        if (this.observer) {
          this.observer.disconnect();
        }
        if (this.scrollListener) {
          window.removeEventListener('scroll', this.scrollListener);
        }
      }

      setupIntersectionObserver() {
        const options = {
          root: null,
          rootMargin: '-20% 0px -20% 0px',
          threshold: 0.5
        };

        this.observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            const item = entry.target;
            if (entry.isIntersecting) {
              item.classList.add('active');
            } else {
              item.classList.remove('active');
            }
          });this.updateProgressBar();
        }, options);

        this.timelineItems.forEach(item => {
          this.observer.observe(item);
        });
      }

      setupScrollListener() {
        this.scrollListener = () => {
          this.updateProgressBar();
        };
        window.addEventListener('scroll', this.scrollListener, { passive: true });
      }

      updateProgressBar() {
        if (!this.progressBar || this.timelineItems.length === 0) return;

        const containerRect = this.getBoundingClientRect();
        const containerTop = containerRect.top + window.pageYOffset;
        const containerHeight = containerRect.height;
        
        const viewportHeight = window.innerHeight;
        const scrollTop = window.pageYOffset;
        const viewportCenter = scrollTop + viewportHeight / 2;

        let progress = 0;

        if (viewportCenter >= containerTop) {
          const scrollProgress = (viewportCenter - containerTop) / containerHeight;
          progress = Math.min(Math.max(scrollProgress * 100, 0), 100);
        }

        this.progressBar.style.height = progress + '%';
      }
    }

    customElements.define('scroll-timeline-{{ ai_gen_id }}', ScrollTimeline{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Service Timeline",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Service Items"
    },
    {
      "type": "text",
      "id": "item_1_price_from",
      "label": "Item 1 - Price from",
      "default": "100"
    },
    {
      "type": "text",
      "id": "item_1_price_to",
      "label": "Item 1 - Price to",
      "default": "500"
    },
    {
      "type": "text",
      "id": "item_1_service_title",
      "label": "Item 1 - Service title",
      "default": "Basic Package"
    },
    {
      "type": "textarea",
      "id": "item_1_description",
      "label": "Item 1 - Description",
      "default": "Perfect for small businesses looking to get started with our services."
    },
    {
      "type": "image_picker",
      "id": "item_1_image",
      "label": "Item 1 - Image"
    },
    {
      "type": "text",
      "id": "item_2_price_from",
      "label": "Item 2 - Price from",
      "default": "500"
    },
    {
      "type": "text",
      "id": "item_2_price_to",
      "label": "Item 2 - Price to",
      "default": "1500"
    },
    {
      "type": "text",
      "id": "item_2_service_title",
      "label": "Item 2 - Service title",
      "default": "Professional Package"
    },
    {
      "type": "textarea",
      "id": "item_2_description",
      "label": "Item 2 - Description",
      "default": "Comprehensive solution for growing businesses with advanced features."
    },
    {
      "type": "image_picker",
      "id": "item_2_image",
      "label": "Item 2 - Image"
    },
    {
      "type": "text",
      "id": "item_3_price_from",
      "label": "Item 3 - Price from",
      "default": "1500"
    },
    {
      "type": "text",
      "id": "item_3_price_to",
      "label": "Item 3 - Price to",
      "default": "5000"
    },
    {
      "type": "text",
      "id": "item_3_service_title",
      "label": "Item 3 - Service title",
      "default": "Enterprise Package"
    },
    {
      "type": "textarea",
      "id": "item_3_description",
      "label": "Item 3 - Description",
      "default": "Full-scale enterprise solution with custom features and dedicated support."
    },
    {
      "type": "image_picker",
      "id": "item_3_image",
      "label": "Item 3 - Image"
    },
    {
      "type": "text",
      "id": "item_4_price_from",
      "label": "Item 4 - Price from"},
    {
      "type": "text",
      "id": "item_4_price_to",
      "label": "Item 4 - Price to"
    },
    {
      "type": "text",
      "id": "item_4_service_title",
      "label": "Item 4 - Service title"
    },
    {
      "type": "textarea",
      "id": "item_4_description",
      "label": "Item 4 - Description"
    },
    {
      "type": "image_picker",
      "id": "item_4_image",
      "label": "Item 4 - Image"
    },
    {
      "type": "text",
      "id": "item_5_price_from",
      "label": "Item 5 - Price from"
    },
    {
      "type": "text",
      "id": "item_5_price_to",
      "label": "Item 5 - Price to"
    },
    {
      "type": "text",
      "id": "item_5_service_title",
      "label": "Item 5 - Service title"
    },
    {
      "type": "textarea",
      "id": "item_5_description",
      "label": "Item 5 - Description"
    },
    {
      "type": "image_picker",
      "id": "item_5_image",
      "label": "Item 5 - Image"
    },
    {
      "type": "text",
      "id": "item_6_price_from",
      "label": "Item 6 - Price from"
    },
    {
      "type": "text",
      "id": "item_6_price_to",
      "label": "Item 6 - Price to"
    },
    {
      "type": "text",
      "id": "item_6_service_title",
      "label": "Item 6 - Service title"
    },
    {
      "type": "textarea",
      "id": "item_6_description",
      "label": "Item 6 - Description"
    },
    {
      "type": "image_picker",
      "id": "item_6_image",
      "label": "Item 6 - Image"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "section_padding",
      "min": 20,
      "max": 100,
      "step": 10,
      "unit": "px",
      "label": "Section padding",
      "default": 60
    },
    {
      "type": "range",
      "id": "item_spacing",
      "min": 20,
      "max": 80,
      "step": 10,
      "unit": "px",
      "label": "Item spacing",
      "default": 40
    },
    {
      "type": "range",
      "id": "card_padding",
      "min": 15,
      "max": 40,
      "step": 5,
      "unit": "px",
      "label": "Card padding",
      "default": 25
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Card border radius",
      "default": 8
    },
    {
      "type": "header",
      "content": "Images"
    },
    {
      "type": "range",
      "id": "image_size",
      "min": 60,
      "max": 120,
      "step": 10,
      "unit": "px",
      "label": "Image size",
      "default": 80
    },
    {
      "type": "range",
      "id": "image_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Image border radius",
      "default": 8
    },
    {
      "type": "header",
      "content": "Timeline Line"
    },
    {
      "type": "color",
      "id": "line_inactive_color",
      "label": "Line inactive color",
      "default": "#e0e0e0"
    },
    {
      "type": "color",
      "id": "line_active_color",
      "label": "Line active color",
      "default": "#007acc"
    },
    {
      "type": "header",
      "content": "Timeline Dots"
    },
    {
      "type": "range",
      "id": "dot_size",
      "min": 12,
      "max": 24,
      "step": 2,
      "unit": "px",
      "label": "Dot size",
      "default": 16
    },
    {
      "type": "color",
      "id": "dot_inactive_color",
      "label": "Dot inactive color",
      "default": "#cccccc"
    },
    {
      "type": "color",
      "id": "dot_active_color",
      "label": "Dot active color",
      "default": "#007acc"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "card_background_color",
      "label": "Card background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "price_color",
      "label": "Price color",
      "default": "#28a745"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Service title color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "price_font_size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Price font size",
      "default": 14
    },
    {
      "type": "range",
      "id": "title_font_size",
      "min": 18,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Service title font size",
      "default": 24
    },
    {
      "type": "range",
      "id": "text_font_size",
      "min": 14,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Text font size",
      "default": 16
    }
  ],
  "presets": [
    {
      "name": "Service Timeline"
    }
  ]
}
{% endschema %}