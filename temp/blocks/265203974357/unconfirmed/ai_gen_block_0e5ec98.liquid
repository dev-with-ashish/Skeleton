{% doc %}
  @prompt
    a customisable name plate section which will show name plate from the product first image user will have option to type their name on it  through a text box, name font style not changing according to selected font, make fonts more accurate and workable, selecting font do not change name font style, add a same name text layer 2 , add real glitter effect option to both the layers, add real glitter effect option to both the layers un animated glittered texts
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-nameplate-container-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    max-width: {{ block.settings.max_width }}px;
    margin: 0 auto;
    background-color: {{ block.settings.background_color }};
    border-radius: {{ block.settings.border_radius }}px;
    overflow: hidden;
  }

  .ai-nameplate-image-wrapper-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    height: auto;
    display: block;
  }

  .ai-nameplate-image-{{ ai_gen_id }} {
    width: 100%;
    height: auto;
    display: block;
  }

  .ai-nameplate-image-placeholder-{{ ai_gen_id }} {
    background-color: #f4f4f4;
    width: 100%;
    height: 400px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .ai-nameplate-image-placeholder-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
    max-width: 300px;
    max-height: 300px;
  }

  .ai-nameplate-empty-state-{{ ai_gen_id }} {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 20px;
    font-size: 14px;
    color: #666;
    text-align: center;
    pointer-events: none;
  }

  .ai-nameplate-text-overlay-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
  }

  .ai-nameplate-text-layer-{{ ai_gen_id }} {
    position: absolute;
    white-space: nowrap;
    text-align: center;
    pointer-events: none;
    overflow: visible;
  }

  .ai-nameplate-text-layer-1-{{ ai_gen_id }} {
    font-family: {{ block.settings.text_font_1.family }}, {{ block.settings.text_font_1.fallback_families }};
    font-style: {{ block.settings.text_font_1.style }};
    font-weight: {{ block.settings.text_font_1.weight }};
    font-size: {{ block.settings.text_size_1 }}px;
    color: {{ block.settings.text_color_1 }};
    top: {{ block.settings.text_position_y_1 }}%;
    left: {{ block.settings.text_position_x_1 }}%;
    transform: translate(-50%, -50%) rotate({{ block.settings.text_rotation_1 }}deg);
    text-shadow: {{ block.settings.text_shadow_1 }}px {{ block.settings.text_shadow_1 }}px {{ block.settings.text_shadow_1 | times: 2 }}px rgba(0,0,0,0.3);
    z-index: {{ block.settings.text_z_index_1 }};
  }

  .ai-nameplate-text-layer-2-{{ ai_gen_id }} {
    font-family: {{ block.settings.text_font_2.family }}, {{ block.settings.text_font_2.fallback_families }};
    font-style: {{ block.settings.text_font_2.style }};
    font-weight: {{ block.settings.text_font_2.weight }};
    font-size: {{ block.settings.text_size_2 }}px;
    color: {{ block.settings.text_color_2 }};
    top: {{ block.settings.text_position_y_2 }}%;
    left: {{ block.settings.text_position_x_2 }}%;
    transform: translate(-50%, -50%) rotate({{ block.settings.text_rotation_2 }}deg);
    text-shadow: {{ block.settings.text_shadow_2 }}px {{ block.settings.text_shadow_2 }}px {{ block.settings.text_shadow_2 | times: 2 }}px rgba(0,0,0,0.3);
    z-index: {{ block.settings.text_z_index_2 }};
  }

  {% if block.settings.enable_glitter_1 %}
    .ai-nameplate-text-layer-1-{{ ai_gen_id }} {
      background: linear-gradient(45deg, 
        {{ block.settings.glitter_color_1_primary }}, 
        {{ block.settings.glitter_color_1_secondary }}, 
        {{ block.settings.glitter_color_1_primary }}, 
        #ffffff,
        {{ block.settings.glitter_color_1_secondary }},
        {{ block.settings.glitter_color_1_primary }}
      );
      background-size: 400% 400%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: ai-glitter-shimmer-1-{{ ai_gen_id }} 3s ease-in-out infinite;
      position: relative;
    }

    .ai-nameplate-text-layer-1-{{ ai_gen_id }}::before {
      content: '';
      position: absolute;
      top: -10px;
      left: -10px;
      right: -10px;
      bottom: -10px;
      background: radial-gradient(circle, transparent 20%, {{ block.settings.glitter_color_1_primary }}22%, transparent 24%),
                  radial-gradient(circle, transparent 20%, {{ block.settings.glitter_color_1_secondary }}22%, transparent 24%),
                  radial-gradient(circle, transparent 20%, #ffffff22%, transparent 24%);
      background-size: 15px 15px, 20px 20px, 25px 25px;
      background-position: 0 0, 10px 10px, 20px 20px;
      animation: ai-glitter-sparkle-1-{{ ai_gen_id }} 2s linear infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes ai-glitter-shimmer-1-{{ ai_gen_id }} {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    @keyframes ai-glitter-sparkle-1-{{ ai_gen_id }} {
      0%, 100% { 
        opacity: 0.8;
        transform: scale(1) rotate(0deg);
      }
      25% { 
        opacity: 1;
        transform: scale(1.1) rotate(90deg);
      }
      50% { 
        opacity: 0.6;
        transform: scale(0.9) rotate(180deg);
      }
      75% { 
        opacity: 1;
        transform: scale(1.05) rotate(270deg);
      }
    }
  {% endif %}

  {% if block.settings.enable_glitter_2 %}
    .ai-nameplate-text-layer-2-{{ ai_gen_id }} {
      background: linear-gradient(45deg, 
        {{ block.settings.glitter_color_2_primary }}, 
        {{ block.settings.glitter_color_2_secondary }}, 
        {{ block.settings.glitter_color_2_primary }}, 
        #ffffff,
        {{ block.settings.glitter_color_2_secondary }},
        {{ block.settings.glitter_color_2_primary }}
      );
      background-size: 400% 400%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: ai-glitter-shimmer-2-{{ ai_gen_id }} 2.5s ease-in-out infinite;
      position: relative;
    }

    .ai-nameplate-text-layer-2-{{ ai_gen_id }}::before {
      content: '';
      position: absolute;
      top: -8px;
      left: -8px;
      right: -8px;
      bottom: -8px;
      background: radial-gradient(circle, transparent 20%, {{ block.settings.glitter_color_2_primary }}22%, transparent 24%),
                  radial-gradient(circle, transparent 20%, {{ block.settings.glitter_color_2_secondary }}22%, transparent 24%),
                  radial-gradient(circle, transparent 20%, #ffffff22%, transparent 24%);
      background-size: 12px 12px, 18px 18px, 22px 22px;
      background-position: 5px 5px, 15px 15px, 25px 25px;
      animation: ai-glitter-sparkle-2-{{ ai_gen_id }} 1.8s linear infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes ai-glitter-shimmer-2-{{ ai_gen_id }} {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    @keyframes ai-glitter-sparkle-2-{{ ai_gen_id }} {
      0%, 100% { 
        opacity: 0.7;
        transform: scale(1) rotate(0deg);
      }
      33% { 
        opacity: 1;
        transform: scale(1.15) rotate(120deg);
      }
      66% { 
        opacity: 0.5;
        transform: scale(0.85) rotate(240deg);
      }
    }
  {% endif %}

  .ai-nameplate-input-container-{{ ai_gen_id }} {
    padding: 20px;
    background-color: {{ block.settings.input_background_color }};
    border-top: 1px solid #e0e0e0;
  }

  .ai-nameplate-input-{{ ai_gen_id }} {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid {{ block.settings.input_border_color }};
    border-radius: {{ block.settings.input_border_radius }}px;
    font-size: 16px;
    background-color: #ffffff;
    color: #333333;
    transition: border-color 0.3s ease;
  }

  .ai-nameplate-input-{{ ai_gen_id }}:focus {
    outline: none;
    border-color: {{ block.settings.input_focus_color }};
  }

  .ai-nameplate-input-label-{{ ai_gen_id }} {
    display: block;
    margin-bottom: 8px;
    font-size: 14px;
    font-weight: 600;
    color: {{ block.settings.input_label_color }};
  }

  @media screen and (max-width: 749px) {
    .ai-nameplate-text-layer-1-{{ ai_gen_id }} {
      font-size: {{ block.settings.text_size_1 | times: 0.7 }}px;
    }
    
    .ai-nameplate-text-layer-2-{{ ai_gen_id }} {
      font-size: {{ block.settings.text_size_2 | times: 0.7 }}px;
    }
  }
{% endstyle %}

<nameplate-customizer-{{ ai_gen_id }}
  class="ai-nameplate-container-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-nameplate-image-wrapper-{{ ai_gen_id }}">
    {% if block.settings.product and block.settings.product.featured_image %}
      <img
        src="{{ block.settings.product.featured_image | image_url: width: 1200 }}"
        alt="{{ block.settings.product.featured_image.alt | escape }}"
        loading="lazy"
        width="{{ block.settings.product.featured_image.width }}"
        height="{{ block.settings.product.featured_image.height }}"
        class="ai-nameplate-image-{{ ai_gen_id }}"
      >
    {% else %}
      <div class="ai-nameplate-image-placeholder-{{ ai_gen_id }}">
        {{ 'product-1' | placeholder_svg_tag }}
        <div class="ai-nameplate-empty-state-{{ ai_gen_id }}">
          Select a product to display its image
        </div>
      </div>
    {% endif %}

    <div class="ai-nameplate-text-overlay-{{ ai_gen_id }}">
      <div 
        class="ai-nameplate-text-layer-{{ ai_gen_id }} ai-nameplate-text-layer-1-{{ ai_gen_id }}"
        data-layer="1"
      >
        {{ block.settings.default_text | default: 'Your Name' }}
      </div>
      
      <div 
        class="ai-nameplate-text-layer-{{ ai_gen_id }} ai-nameplate-text-layer-2-{{ ai_gen_id }}"
        data-layer="2"
      >
        {{ block.settings.default_text | default: 'Your Name' }}
      </div>
    </div>
  </div>

  <div class="ai-nameplate-input-container-{{ ai_gen_id }}">
    <label for="nameplate-input-{{ ai_gen_id }}" class="ai-nameplate-input-label-{{ ai_gen_id }}">
      {{ block.settings.input_label }}
    </label>
    <input
      type="text"
      id="nameplate-input-{{ ai_gen_id }}"
      class="ai-nameplate-input-{{ ai_gen_id }}"
      placeholder="{{ block.settings.input_placeholder }}"
      value="{{ block.settings.default_text }}"
      maxlength="50"
    >
  </div>
</nameplate-customizer-{{ ai_gen_id }}>

<script>
  (function() {
    class NameplateCustomizer{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        this.input = this.querySelector('.ai-nameplate-input-{{ ai_gen_id }}');
        this.textLayers = this.querySelectorAll('.ai-nameplate-text-layer-{{ ai_gen_id }}');
        
        if (this.input && this.textLayers.length > 0) {
          this.setupEventListeners();
          this.loadFonts();
        }
      }

      setupEventListeners() {
        this.input.addEventListener('input', (e) => {
          const text = e.target.value.trim() || '{{ block.settings.default_text | default: "Your Name" }}';
          this.textLayers.forEach(layer => {
            layer.textContent = text;
          });
        });

        this.input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            this.input.blur();
          }
        });
      }

      loadFonts() {
        const font1 = '{{ block.settings.text_font_1.family }}';
        const font2 = '{{ block.settings.text_font_2.family }}';
        
        if (font1 && font1 !== 'inherit') {
          this.loadFont(font1);
        }
        
        if (font2 && font2 !== 'inherit') {
          this.loadFont(font2);
        }
      }

      loadFont(fontFamily) {
        if (document.fonts && document.fonts.load) {
          document.fonts.load(`1em ${fontFamily}`).then(() => {
            this.textLayers.forEach(layer => {
              layer.style.fontFamily = `${fontFamily}, ${layer.style.fontFamily}`;
            });
          }).catch(() => {
            console.warn(`Failed to load font: ${fontFamily}`);
          });
        }
      }
    }

    customElements.define('nameplate-customizer-{{ ai_gen_id }}', NameplateCustomizer{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Custom nameplate",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Product"
    },
    {
      "type": "product",
      "id": "product",
      "label": "Product"
    },
    {
      "type": "text",
      "id": "default_text",
      "label": "Default text",
      "default": "Your Name"
    },
    {
      "type": "header",
      "content": "Text Layer 1"
    },
    {
      "type": "font_picker",
      "id": "text_font_1",
      "label": "Font",
      "default": "helvetica_n4"
    },
    {
      "type": "range",
      "id": "text_size_1",
      "min": 12,
      "max": 120,
      "step": 2,
      "unit": "px",
      "label": "Font size",
      "default": 48
    },
    {
      "type": "color",
      "id": "text_color_1",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "text_position_x_1",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "Horizontal position",
      "default": 50
    },
    {
      "type": "range",
      "id": "text_position_y_1",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "Vertical position",
      "default": 50
    },
    {
      "type": "range",
      "id": "text_rotation_1",
      "min": -45,
      "max": 45,
      "step": 1,
      "unit": "deg",
      "label": "Rotation",
      "default": 0
    },
    {
      "type": "range",
      "id": "text_shadow_1",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "Shadow",
      "default": 2
    },
    {
      "type": "range",
      "id": "text_z_index_1",
      "min": 1,
      "max": 10,
      "step": 1,
      "label": "Layer order",
      "default": 2
    },
    {
      "type": "checkbox",
      "id": "enable_glitter_1",
      "label": "Enable glitter effect",
      "default": false
    },
    {
      "type": "color",
      "id": "glitter_color_1_primary",
      "label": "Glitter primary color",
      "default": "#FFD700"
    },
    {
      "type": "color",
      "id": "glitter_color_1_secondary",
      "label": "Glitter secondary color",
      "default": "#FFA500"
    },
    {
      "type": "header",
      "content": "Text Layer 2"
    },
    {
      "type": "font_picker",
      "id": "text_font_2",
      "label": "Font",
      "default": "helvetica_n4"
    },
    {
      "type": "range",
      "id": "text_size_2",
      "min": 12,
      "max": 120,
      "step": 2,
      "unit": "px",
      "label": "Font size",
      "default": 44
    },
    {
      "type": "color",
      "id": "text_color_2",
      "label": "Text color",
      "default": "#FFFFFF"
    },
    {
      "type": "range",
      "id": "text_position_x_2",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "Horizontal position",
      "default": 52
    },
    {
      "type": "range",
      "id": "text_position_y_2",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "Vertical position",
      "default": 52
    },
    {
      "type": "range",
      "id": "text_rotation_2",
      "min": -45,
      "max": 45,
      "step": 1,
      "unit": "deg",
      "label": "Rotation",
      "default": 0
    },
    {
      "type": "range",
      "id": "text_shadow_2",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "Shadow",
      "default": 1
    },
    {
      "type": "range",
      "id": "text_z_index_2",
      "min": 1,
      "max": 10,
      "step": 1,
      "label": "Layer order",
      "default": 1
    },
    {
      "type": "checkbox",
      "id": "enable_glitter_2",
      "label": "Enable glitter effect",
      "default": false
    },
    {
      "type": "color",
      "id": "glitter_color_2_primary",
      "label": "Glitter primary color",
      "default": "#C0C0C0"
    },
    {
      "type": "color",
      "id": "glitter_color_2_secondary",
      "label": "Glitter secondary color",
      "default": "#E6E6FA"
    },
    {
      "type": "header",
      "content": "Input Field"
    },
    {
      "type": "text",
      "id": "input_label",
      "label": "Input label",
      "default": "Enter your name"
    },
    {
      "type": "text",
      "id": "input_placeholder",
      "label": "Input placeholder",
      "default": "Type your name here..."
    },
    {
      "type": "color",
      "id": "input_background_color",
      "label": "Input area background",
      "default": "#f8f8f8"
    },
    {
      "type": "color",
      "id": "input_border_color",
      "label": "Input border color",
      "default": "#cccccc"
    },
    {
      "type": "color",
      "id": "input_focus_color",
      "label": "Input focus color",
      "default": "#007acc"
    },
    {
      "type": "color",
      "id": "input_label_color",
      "label": "Input label color",
      "default": "#333333"
    },
    {
      "type": "range",
      "id": "input_border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Input border radius",
      "default": 6
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "max_width",
      "min": 300,
      "max": 1200,
      "step": 50,
      "unit": "px",
      "label": "Maximum width",
      "default": 600
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 12
    }
  ],
  "presets": [
    {
      "name": "Custom nameplate"
    }
  ]
}
{% endschema %}